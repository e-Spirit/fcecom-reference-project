!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TPP_RECEIVER=t():e.TPP_RECEIVER=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.6.5"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(4)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var o=n(7),r=n(8);e.exports=function(e){return o(r(e))}},function(e,t,n){var o=n(27);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==o(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?o:n)(e)}},function(e,t,n){"use strict";var o,r=n(11),i=(o=r)&&o.__esModule?o:{default:o};!function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var e=function(e,t,n){"function"==typeof e&&e.apply(t,n)},t=function(){var e=null,t=null;function n(t){return t?"id"in t?t:{store:t.getStoreType(),language:t.getLanguage()||e,id:t.getId(),contentId:t.getContentId(),template:t.getTemplate()}:{id:-1,store:"sitestore",language:e}}function o(e){var n=t&&"number"==typeof t.contentId?{contentId:t.contentId.toString()}:{},o=(0,i.default)({},t,n);WE_API.Common.setPreviewElement(o)}return{getLanguage:function(){return e},update:function(r){t=n(r),e=t.language||e,o()},refresh:function(e){e&&!function(e){var o=n(e);return o.store.toLowerCase()==t.store.toLowerCase()&&("contentId"in t&&-1!=t.contentId?o.contentId==t.contentId&&o.template==t.template:o.id==t.id)}(e)||o()}}}(),n=function(n,o){n?"CS_DATASET"===n.getElementType()?WE_API.Common.execute("class:TppApi",{action:"FSID_TO_PREVIEW_ID",language:n.getLanguage()||t.getLanguage(),template:n.getTemplate().toFixed(0),store:n.getStoreType(),contentId:n.getId().toFixed(0)},o):WE_API.Common.execute("class:TppApi",{action:"FSID_TO_PREVIEW_ID",language:n.getLanguage()||t.getLanguage(),id:n.getId().toFixed(0),store:n.getStoreType()},o):e(o,this,[null])},o=function(t,n,o){!function(t,n,o){t?WE_API.Common.execute("class:TppApi",{action:"STATUS",previewId:t},(function(t){u(t);var i=r(t);i.error?e(o,this,[i]):e(n,this,[i.object])})):e(o,this,[{error:!0,object:"No previewId given in getElementStatus in receiver"}])}(t,(function(t){var r;"unknown"!==t.name||t.id?(t.templateId?r={contentId:+t.entityId,template:+t.templateId,id:t.entityId,store:t.storeType,language:t.language}:(r={id:t.id,store:t.storeType,language:t.language},-1!=+t.entityId&&(r.contentId=+t.entityId,r.pageref=+t.status.id)),e(n,this,[r])):e(o,this,[{error:!1,previewId:null}])}),o)},r=function(e,t){if("string"==typeof e&&null!==e.match(/^\s*[\[{"]/))try{return JSON.parse(e)}catch(e){return void 0===t?null:t}},a=function(e){console.log(e.object.stacktrace);var t=e.object.localizedTitle.length>0,n=e.object.localizedMessage.length>0;WE_API.Common.showMessage(t?e.object.localizedTitle:"Unknown error",n?e.object.localizedMessage:"An unknown error occured. See console for details.")},u=function(e){var t=r(e);t&&t.error&&a(t)},c=function(t,n){var o=r(t);null===o?function(e){console.log("Invalid response: ",e),WE_API.Common.showMessage("Invalid response","An invalid response was received from TppApi-Service. See console for details")}(t):o.error?a(o):e(n,this,[o.object])};let s=!1;var l=function(){var e,o=null,r=function(e,t){var n={_messageType:"EVENT",_eventId:e,_payload:t};o&&o.window.postMessage({tpp:n},o.origin)},i=function(t){if(null!==t&&("SS_PAGE"===t.getElementType()||"CS_DATASET"===t.getElementType()||null===t.getElementType())){if(!o&&void 0===e)return void(e=t);n(t,(function(e){u(e),r("TPP_PREVIEW_REQUEST",e)}))}};WE_API.Common.addPreviewRequestHandler(i),WE_API.Common.addNavigationChangeListener((function(e){null===e?r("TPP_NAVIGATION_CHANGED",{error:!1,object:null}):n(e,(function(e){u(e),r("TPP_NAVIGATION_CHANGED",e)}))})),WE_API.Common.addItemsPlugin("status",(function(e,n){var o=[];if(s){const n="de"===WE_API.Common.getLocale()?"Änderungen ausblenden":"Hide changes";o.push(e.createItem(null,n,(function(){r("TPP_RESET_DISPLAY_CHANGES_REQUEST"),s=!s,t.refresh()})))}else{const n="de"===WE_API.Common.getLocale()?"Alle Änderungen anzeigen":"Display changes";o.push(e.createItem(null,n,(function(){r("TPP_DISPLAY_CHANGES_REQUEST"),s=!s,t.refresh()})))}n(o)}));WE_API.Common.addWorkflowTransitionListener((function(e){var o=e.getWorkflowTarget();t.refresh(o),n(o,(function(n){c(n,(function(n){var o=function(e,t){var n={error:!1};return n.object={previewId:t,workflowId:e.getWorkflowId(),transitionId:e.getTransitionId(),isFirstTransition:e.isFirstTransition(),isEndState:e.isEndState(),isDeleted:e.isDeleted(),isReleased:e.isReleased()},n}(e,n);r("TPP_WORKFLOW_ACTION",o),t.refresh()}))}))}));var a=document.getElementById("previewContent");null!==a&&(document.body.addEventListener("dragstart",(function(e){null===e.target.closest(".fs-CropBox")&&(a.style.pointerEvents="none")}),!0),document.body.addEventListener("dragend",(function(e){a.style.removeProperty("pointer-events")}),!0));var l=document.querySelector(".fs-sidebar-content");return null!==l&&l.addEventListener("dragstart",(function(e,n){if(null===document.querySelector(".gwt-PopupPanelGlass")){var o=e.target;if(null!==(n=o.closest("[fsid]"))){var i=n.getAttribute("fsid").split(":");if("FSID"===i[0]){var a={};i[2].split(";").forEach((function(e){(e=e.match(/^([^=]*)=(.*)$/))&&(a[e[1]]=e[2])}));var u=null;null!==(u=void 0!==a.tbl?{template:a.tbl,contentId:a.id,store:a.stype}:{id:a.id,store:a.stype})&&(u.store=["PAGESTORE","CONTENTSTORE","SITESTORE","MEDIASTORE","TEMPLATESTORE","GLOBALSTORE"][+u.store],u.action="FSID_TO_PREVIEW_ID",u.language=t.getLanguage(),WE_API.Common.execute("class:TppApi",u,(function(e){c(e,(function(e){l(o,e)}))})))}}else if(null!==(n=o.closest("[data-identifier]"))){var s=document.querySelector(".fs-sidebar-button.pressed[data-fs-element-name]");null!==s&&l(o,"custom:dap:"+s.getAttribute("data-fs-element-name")+":"+n.getAttribute("data-identifier"))}}function l(e,t){var n=document.getElementById("previewContent").getBoundingClientRect(),o=document.body.appendChild(document.createElement("div"));function i(e,n,o){r("TPP_DRAG_ACTION",{error:!1,object:{previewId:t,phase:e,x:n||-1,y:o||-1}})}o.setAttribute("style","position:absolute;z-index:10;overflow:auto;top:"+n.top+"px;left:"+n.left+"px;width:"+n.width+"px;height:"+n.height+"px;"),i("start"),o.addEventListener("dragover",(function(e){e.preventDefault(),i("drag",e.offsetX,e.offsetY)})),o.addEventListener("drop",(function(e){e.preventDefault(),i("drop",e.offsetX,e.offsetY)}));var a=function(){i("end"),document.body.removeChild(o),e.removeEventListener("dragend",a)};e.addEventListener("dragend",a)}})),MPP_API.addParameterizedListener(e=>r("TPP_MPP_CHANGE",{type:"onMppParameterizedChange",result:e})),MPP_API.addParameterListener(()=>r("TPP_MPP_CHANGE",{type:"onMppParameterChange",result:void 0})),MPP_API.addTimeParameterListener(e=>r("TPP_MPP_CHANGE",{type:"onMppTimeParameterChange",result:e})),{connectApi:function(t){t&&(o={window:t.source,origin:t.origin},e&&(i(e),e=null,function(){if(window.CxtHost)try{window.CxtHost.client.shadowRoot.querySelector("cc-toolbar-undo-redo").style.display="none"}catch(e){console.debug("cannot hide undo/redo toolbar",e)}}()))},postEventMessage:r}}();window.addEventListener("message",(function(e){if(window.TEST_MODE||window.CxtHost.client.shadowRoot.querySelector("cc-preview").shadowRoot.querySelector("#previewContent").getAttribute("src").startsWith(e.origin)){var n=function(t,n){e.source.postMessage({tpp:{_messageType:"CALLBACK",_callbackId:e.data.tpp._callbackId||null,_response:t,_params:n||null}},e.origin)};if("object"==typeof e.data&&"object"==typeof e.data.tpp){if(e.data.tpp.execute)if(e.data.tpp.execute.source){var r=new Function("return "+e.data.tpp.execute.source)().apply(null,e.data.params);n(r)}else{if(void 0!==window.CxtHost){var i=document.getElementById("previewContent");null===i&&(i=window.CxtHost.client.shadowRoot.querySelector("cc-preview").shadowRoot.querySelector("#previewContent")),void 0!==e.data.tpp.params.boundX&&(e.data.tpp.params.boundX+=i.getBoundingClientRect().x),void 0!==e.data.tpp.params.boundY&&(e.data.tpp.params.boundY+=i.getBoundingClientRect().y)}WE_API.Common.execute(e.data.tpp.execute,e.data.tpp.params,(function(e){u(e),n(e)}))}if(e.data.tpp.connectApi&&(l.connectApi(e),n({error:!1,message:"successfull connected"})),e.data.tpp.ping){var a=!window.CxtHost;n({error:!1,pong:!0,version:"2.4.1",isLegacyCC:a})}if(e.data.tpp.hideChanges&&(s=!1,t.refresh()),e.data.tpp.setPreviewElement){var c=e.data.tpp.previewId;c?o(c,(function(e){t.update(e),n({error:!1,previewId:c})}),(function(e){n(e)})):null===c?(t.update(null),n({error:!1,previewId:null})):(t.refresh(),n({error:!1,previewId:null}))}e.data.tpp.mpp&&n(MPP_API[e.data.tpp.mpp.method].apply(MPP_API,e.data.tpp.mpp.args||[]))}}}))}()},function(e,t,n){e.exports={default:n(12),__esModule:!0}},function(e,t,n){n(13),e.exports=n(1).Object.assign},function(e,t,n){var o=n(14);o(o.S+o.F,"Object",{assign:n(24)})},function(e,t,n){var o=n(0),r=n(1),i=n(15),a=n(17),u=n(5),c=function(e,t,n){var s,l,p,f=e&c.F,d=e&c.G,g=e&c.S,v=e&c.P,m=e&c.B,y=e&c.W,E=d?r:r[t]||(r[t]={}),P=E.prototype,h=d?o:g?o[t]:(o[t]||{}).prototype;for(s in d&&(n=t),n)(l=!f&&h&&void 0!==h[s])&&u(E,s)||(p=l?h[s]:n[s],E[s]=d&&"function"!=typeof h[s]?n[s]:m&&l?i(p,o):y&&h[s]==p?function(e){var t=function(t,n,o){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,o)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(p):v&&"function"==typeof p?i(Function.call,p):p,v&&((E.virtual||(E.virtual={}))[s]=p,e&c.R&&P&&!P[s]&&a(P,s,p)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,n){var o=n(16);e.exports=function(e,t,n){if(o(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,o){return e.call(t,n,o)};case 3:return function(n,o,r){return e.call(t,n,o,r)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var o=n(18),r=n(23);e.exports=n(3)?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var o=n(19),r=n(20),i=n(22),a=Object.defineProperty;t.f=n(3)?Object.defineProperty:function(e,t,n){if(o(e),t=i(t,!0),o(n),r)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var o=n(2);e.exports=function(e){if(!o(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(3)&&!n(4)((function(){return 7!=Object.defineProperty(n(21)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var o=n(2),r=n(0).document,i=o(r)&&o(r.createElement);e.exports=function(e){return i?r.createElement(e):{}}},function(e,t,n){var o=n(2);e.exports=function(e,t){if(!o(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!o(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!o(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var o=n(25),r=n(36),i=n(37),a=n(38),u=n(7),c=Object.assign;e.exports=!c||n(4)((function(){var e={},t={},n=Symbol(),o="abcdefghijklmnopqrst";return e[n]=7,o.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=o}))?function(e,t){for(var n=a(e),c=arguments.length,s=1,l=r.f,p=i.f;c>s;)for(var f,d=u(arguments[s++]),g=l?o(d).concat(l(d)):o(d),v=g.length,m=0;v>m;)p.call(d,f=g[m++])&&(n[f]=d[f]);return n}:c},function(e,t,n){var o=n(26),r=n(35);e.exports=Object.keys||function(e){return o(e,r)}},function(e,t,n){var o=n(5),r=n(6),i=n(28)(!1),a=n(31)("IE_PROTO");e.exports=function(e,t){var n,u=r(e),c=0,s=[];for(n in u)n!=a&&o(u,n)&&s.push(n);for(;t.length>c;)o(u,n=t[c++])&&(~i(s,n)||s.push(n));return s}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var o=n(6),r=n(29),i=n(30);e.exports=function(e){return function(t,n,a){var u,c=o(t),s=r(c.length),l=i(a,s);if(e&&n!=n){for(;s>l;)if((u=c[l++])!=u)return!0}else for(;s>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var o=n(9),r=Math.min;e.exports=function(e){return e>0?r(o(e),9007199254740991):0}},function(e,t,n){var o=n(9),r=Math.max,i=Math.min;e.exports=function(e,t){return(e=o(e))<0?r(e+t,0):i(e,t)}},function(e,t,n){var o=n(32)("keys"),r=n(34);e.exports=function(e){return o[e]||(o[e]=r(e))}},function(e,t,n){var o=n(1),r=n(0),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:o.version,mode:n(33)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports=!0},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+o).toString(36))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var o=n(8);e.exports=function(e){return Object(o(e))}}]).default}));
//# sourceMappingURL=fs-tpp-receiver.js.map